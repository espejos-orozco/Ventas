<?xml version='1.0' encoding='UTF-8' ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html">

    <h:head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <h:outputStylesheet name="./css/default.css"/>
        <h:outputStylesheet name="./css/cssLayout.css"/>
        <!--bootstrap.min.css-->
        <!-- CSS only -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous"/>
        <link rel="stylesheet" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css" />
        <title id="title">Facelets Template</title>
    </h:head>

    <h:body>

        <div id="top">
            <nav class="navbar navbar-expand-sm bg-dark navbar-dark">
                <!-- Brand -->
                <a class="navbar-brand" href="#">Logo</a>

                <!-- Links -->
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="http://localhost:8080/Ventas/faces/Empleados.xhtml">Empleados</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="http://localhost:8080/Ventas/faces/Clientes.xhtml">Clientes</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="http://localhost:8080/Ventas/faces/Sucursales.xhtml">Sucursales</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="http://localhost:8080/Ventas/faces/PedidosSolicitados.xhtml">Pedidos Solicitados</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="http://localhost:8080/Ventas/faces/EmpleadosEnviados.xhtml">Pedidos Enviados</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="btn-cerrar-sesion">Cerrar Sesión</a>
                    </li>
                </ul>
            </nav>
        </div>

        <div id="content" class="center_content">
            <ui:insert name="content">Content</ui:insert>
        </div>

        <div id="bottom">
            <ui:insert name="bottom">Bottom</ui:insert>
        </div>

        <!-- Include all js compiled plugins (below), or include individual files as needed -->

        <script src="assets/js/jquery.js"></script>

        <!--modernizr.min.js-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>

        <!--bootstrap.min.js-->
        <script src="assets/js/bootstrap.min.js"></script>

        <!-- bootsnav js -->
        <script src="assets/js/bootsnav.js"></script>

        <!--owl.carousel.js-->
        <script src="assets/js/owl.carousel.min.js"></script>


        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>

        <script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>


        <!--Custom JS-->
        <script src="assets/js/custom.js"></script>

        <!-- Cookies -->
        <script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>
        
        <script>
            $(document).ready(function () {
                checkSession();
                let locationActual = window.location.toString();

                //Clientes
                if (locationActual.indexOf("Clientes.xhtml") > -1) {

                }
                //Empleados
                if (locationActual.indexOf("Empleados.xhtml") > -1) {
                    $(document).find("#title").text("Empleados");
                    cargarEmpleados();
                }
                if (locationActual.indexOf("EmpleadosEditar.xhtml") > -1) {
                    let parametros = locationActual.split("?");
                    let param = parametros[1].split("=");
                    let id = null;
                    if (param[0] == "id") {
                        id = param[1];
                    }
                    
                    cargarEmpleado(id);
                }
                if (locationActual.indexOf("EmpleadosAgregar.xhtml") > -1) {

                }
                //Artículos
                if (locationActual.indexOf("Articulos.xhtml") > -1) {

                }
                //Sucursales
                if (locationActual.indexOf("Sucursales.xhtml") > -1) {

                }
            });

            function cargarEmpleados() {
                //Creo la tabla
                let tbl_empleados = $(document).find("#tbl_empleados").DataTable({
                });

                //Consulto los empleados
                /*$.ajax({
                 url: "http://localhost:8080/VentasOnlinev2/webresources/entities.personal",
                 beforeSend: function (xhr) {
                 
                 }
                 }).done(function (xml) {
                 let personal = new Array();
                 $(xml).find("personal").each(function (idx, v) {
                 let personal_id = $(v).find("personal_id").eq(0).text();
                 let nombre = $(v).find("nombre").eq(0).text();
                 let apellido = $(v).find("apellido").eq(0).text();
                 let fecha_nacimiento_date = $(v).find("fecha_nacimiento_date").eq(0).text();
                 let fecha_ingreso_date = $(v).find("fecha_ingreso_date").eq(0).text();
                 let acceso_sistema = $(v).find("acceso_sistema").eq(0).text();
                 let usuario = $(v).find("usuario").eq(0).text();
                 let password = $(v).find("password").eq(0).text();
                 let activo = $(v).find("activo").eq(0).text();
                 let fecha_registro = $(v).find("fecha_registro").eq(0).text();
                 
                 personal.push({
                 personal_id : personal_id,
                 nombre : nombre,
                 apellido : apellido,
                 fecha_nacimiento_date : fecha_nacimiento_date,
                 fecha_ingreso_date : fecha_ingreso_date,
                 acceso_sistema : acceso_sistema,    
                 usuario : usuario,
                 password : password,
                 activo : activo,
                 fecha_registro : fecha_registro
                 });
                 });
                 tbl_empleados.rows.add(personal).draw();
                 });
                 */
                let personal = new Array();
                personal.push({
                    personal_id: "personal_id",
                    nombre: "nombre",
                    apellido: "apellido",
                    fecha_nacimiento_date: "fecha_nacimiento_date",
                    fecha_ingreso_date: "fecha_ingreso_date",
                    acceso_sistema: "acceso_sistema",
                    usuario: "usuario",
                    password: "password",
                    activo: "activo",
                    fecha_registro: "fecha_registro"
                });

                let rows = new Array();
                personal.forEach(function (p) {
                    let row = new Array();
                    row.push(p.personal_id);
                    row.push(p.nombre);
                    row.push(p.apellido);
                    row.push(p.fecha_nacimiento_date);
                    row.push(p.fecha_ingreso_date);
                    row.push(p.acceso_sistema);
                    row.push(p.activo);
                    row.push("<button>Eliminar</button><button >Editar</button>");
                    rows.push(row);
                });
                tbl_empleados.rows.add(rows).draw();
            }

            function cargarEmpleado(id) {
                //Consulto los empleados
                let personal = new Array();
                personal.push({
                    personal_id: "personal_id",
                    nombre: "nombre",
                    apellido: "apellido",
                    fecha_nacimiento_date: "fecha_nacimiento_date",
                    fecha_ingreso_date: "fecha_ingreso_date",
                    acceso_sistema: "acceso_sistema",
                    usuario: "usuario",
                    password: "password",
                    activo: "activo",
                    fecha_registro: "fecha_registro"
                });

                if (personal.length) {
                    //Editar campos

                } else {
                    window.location.href = 'http://localhost:8080/Ventas/faces/Empleados.xhtml?';
                }

                /*$.ajax({
                 url: "http://localhost:8080/VentasOnlinev2/webresources/entities.personal/"+id,
                 beforeSend: function (xhr) {
                 
                 }
                 }).done(function (xml) {
                 let personal = new Array();
                 $(xml).find("personal").each(function (idx, v) {
                 let personal_id = $(v).find("personal_id").eq(0).text();
                 let nombre = $(v).find("nombre").eq(0).text();
                 let apellido = $(v).find("apellido").eq(0).text();
                 let fecha_nacimiento_date = $(v).find("fecha_nacimiento_date").eq(0).text();
                 let fecha_ingreso_date = $(v).find("fecha_ingreso_date").eq(0).text();
                 let acceso_sistema = $(v).find("acceso_sistema").eq(0).text();
                 let usuario = $(v).find("usuario").eq(0).text();
                 let password = $(v).find("password").eq(0).text();
                 let activo = $(v).find("activo").eq(0).text();
                 let fecha_registro = $(v).find("fecha_registro").eq(0).text();
                 
                 personal.push({
                 personal_id: personal_id,
                 nombre: nombre,
                 apellido: apellido,
                 fecha_nacimiento_date: fecha_nacimiento_date,
                 fecha_ingreso_date: fecha_ingreso_date,
                 acceso_sistema: acceso_sistema,
                 usuario: usuario,
                 password: password,
                 activo: activo,
                 fecha_registro: fecha_registro
                 });
                 });
                 });*/
            }
            
            $(document).on("click", "button", function () {
                let tbl_empleados = $(document).find("#tbl_empleados").DataTable();
                let accion = $(this).text();
                let tr = $(this).closest("tr");
                let row = null;
                let id = null;
                switch (accion) {
                    case "Eliminar":
                        row = tbl_empleados.row(tr).data();
                        id = row[0];
                        $.ajax({
                            url: "http://localhost:8080/VentasOnlinev2/webresources/entities.personal/" + id,
                            type: "DELETE",
                            beforeSend: function (xhr) {

                            }
                        }).done(function (xml) {
                            tbl_empleados.row(row).remove().data();
                            alert("Se ha eliminado con éxito");
                        });

                        break;
                    case "Editar":
                        row = tbl_empleados.row(tr).data();
                        id = row[0];

                        window.location.href = 'http://localhost:8080/Ventas/faces/EmpleadosEditar.xhtml?id=' + id;
                        break;

                }
                alert(accion);
            });


            function checkSession(){
                let session = Cookies.get('session_root');

                if (session == undefined) {
                    window.location.href = 'http://localhost:8080/Ventas/';

                } else {
                    console.log(session);
                }
            }

            $(document).on("click", "#btn-cerrar-sesion", function () {
                Cookies.remove('session_root');
                checkSession();
                
            });

            function cargando(cargar = true) {
                if (cargar) {
                    if ($(document).find("#div-loading").prop("hidden")) {
                        $("#div-loading").prop("hidden", false);
                        //Se muestra dialogo
                        $("#div-loading").dialog({
                            resizable: false,
                            height: 400,
                            with : 400,
                            modal: true,
                            close: function () {
                                $("#div-loading").prop("hidden", true);
                            },
                            open: function () {
                                $(".ui-button").prop("hidden", true);
                            }
                        }).dialog("open");
                    }
                } else {
                    //Se oculta el dialogo
                    $("#div-loading").dialog("close");
            }
            }
        </script>

    </h:body>

</html>